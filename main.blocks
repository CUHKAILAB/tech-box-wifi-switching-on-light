<xml xmlns="https://developers.google.com/blockly/xml"><variables><variable id="}8~?dPAgLJYQa`am+6J|">strip</variable><variable id="++7BR~T2W[|hza3Dw1_z">WIFI_MODE</variable><variable id="ro/.Fk%RK[`+HQ30XVP,">SSID_1</variable><variable id="$5gL69CYgbO,}5wH5$Nw">PASSWORD_1</variable><variable id="Io?1mB-?z=A%GA;@e2D`">SSID_2</variable><variable id="A1u`W_fj!F7F7N6pgGH.">PASSWORD_2</variable><variable id="{;{s^eq?FqUKd(X,X4Nh">result</variable><variable id="V/][yu!D*sB/4,XfRWjS">serial_str</variable><variable id="^fLp6BtXTeCO$uIr@qd@">client_ID</variable><variable id="aKlUvx~CY#P1WpSda]zj">GET_command</variable><variable id="jMDFA?[3O]fgxriKhf[5">GET_pos</variable><variable id="_awNfogzFHn(`eA]M8Q%">HTTP_pos</variable></variables><block type="pxt-on-start" id="a@6QN=ib5S7:QpG.-zMV" x="0" y="0"><statement name="HANDLER"><block type="typescript_statement" id="BvEbb5p}[qCCls}J6v/+" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="let LED_status: number = 0" numlines="1" declaredvars="LED_status"></mutation><next><block type="typescript_statement" id="WC8z*se_PQhgyPQ}|fvw" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="let serial_str: string = &quot;&quot;" numlines="1" declaredvars="serial_str"></mutation><next><block type="typescript_statement" id="u2i5/gYxvxScYzFtP{iV" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="let GET_success: boolean = false" numlines="1" declaredvars="GET_success"></mutation><next><block type="typescript_statement" id="U0[k.uuum:U}z3$m+Q,9" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="let client_ID = &quot;&quot;" numlines="1" declaredvars="client_ID"></mutation><next><block type="typescript_statement" id="bWwKOBO3ZeHGq}W.COH{" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="let GET_command = &quot;&quot;" numlines="1" declaredvars="GET_command"></mutation><next><block type="device_show_leds" id="uq#usa4;{fzEb]tyv9Z/"><field name="LEDS">`&#10;        # # . # # &#10;        # . . . # &#10;        . . . . . &#10;        . . . . . &#10;        . . . . .&#10;        `</field><next><block type="variables_set" id="*(afAD*Sd15T!cOTRJ.Z"><field name="VAR" id="}8~?dPAgLJYQa`am+6J|">strip</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="neopixel_create" id="R2(o;,R?EWMm7BXvdeQU"><field name="pin">DigitalPin.P1</field><field name="mode">NeoPixelMode.RGB</field><value name="numleds"><shadow type="math_number" id="mM!cMlnRD/y)Zu4)-$!w"><field name="NUM">60</field></shadow></value></block></value><next><block type="device_pause" id="oht?WG(H_7;W/(B!!y$/"><value name="pause"><shadow type="timePicker" id="k.CxK_CKoYdGiIl-Ay06"><field name="ms">100</field></shadow></value><next><block type="neopixel_set_strip_color" id="i8bm.o@vHHT58sY9;%hs"><value name="strip"><block type="variables_get" id="#kf2BqkRzPFiF`Z.lWrV"><field name="VAR" id="}8~?dPAgLJYQa`am+6J|">strip</field></block></value><value name="rgb"><shadow type="neopixel_colors" id="X[S;LMi2mrN|}.l$gld*"><field name="color">NeoPixelColors.Red</field></shadow></value><next><block type="neopixel_show" id="O-}+uzD*`WiiI@]/A.l!"><value name="strip"><block type="variables_get" id="t%0a;p0cEeg8HC3YIJOi"><field name="VAR" id="}8~?dPAgLJYQa`am+6J|">strip</field></block></value><next><block type="device_set_digital_pin" id="uwn?G;{z^{9kR-F5jVWI"><field name="name">DigitalPin.P6</field><value name="value"><shadow type="math_number_minmax" id=".,wlE)tXf^)6!uFloQoT"><mutation min="0" max="1" label="Number" precision="0"/><field name="SLIDER">0</field></shadow></value><next><block type="device_set_digital_pin" id="w@+KZGHwH:eAvLM1dwQy"><field name="name">DigitalPin.P7</field><comment>basic.pause(2000)</comment><value name="value"><shadow type="math_number_minmax" id="6]^KilLK90)br%n)Oetg"><mutation min="0" max="1" label="Number" precision="0"/><field name="SLIDER">0</field></shadow></value><next><block type="device_set_digital_pin" id="X|bx{]sBLr4q%`c@}O[L"><field name="name">DigitalPin.P9</field><comment>basic.pause(2000)</comment><value name="value"><shadow type="math_number_minmax" id="8fS`)*h8%paFDwq|5aKt"><mutation min="0" max="1" label="Number" precision="0"/><field name="SLIDER">0</field></shadow></value><next><block type="device_show_leds" id="r#J6+{DpSjsOXR~~@AQ]"><field name="LEDS">`&#10;        # . . . # &#10;        . # # # . &#10;        . . . . . &#10;        . . . . . &#10;        . . . . .&#10;        `</field><comment>basic.pause(2000)</comment><next><block type="basic_show_icon" id="oCa*`vevW(B)t1vaN,G="><field name="i">IconNames.No</field><next><block type="variables_set" id="E-xA=)K@U2M05la-}fTr"><field name="VAR" id="++7BR~T2W[|hza3Dw1_z">WIFI_MODE</field><value name="VALUE"><shadow type="math_number" id="de[6atZXMUQyDf/xQdG#"><field name="NUM">2</field></shadow></value><next><block type="typescript_statement" id="NA|[P_^6Dmdn6Qo_G+aa" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="const Tx_pin: SerialPin = SerialPin.P8" numlines="1" declaredvars="Tx_pin"></mutation><next><block type="typescript_statement" id="oiha:hy_c`Y0z{(;gby$" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="const Rx_pin: SerialPin = SerialPin.P12" numlines="1" declaredvars="Rx_pin"></mutation><next><block type="typescript_statement" id="b62H2YPOw]NnurKD@5=}" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="const LED_pin: DigitalPin = DigitalPin.P6" numlines="1" declaredvars="LED_pin"></mutation><next><block type="variables_set" id="@P.$NomOi|Ych[u;Ps-#"><field name="VAR" id="ro/.Fk%RK[`+HQ30XVP,">SSID_1</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="text" id="H@xVQoldrgqn$h+*-u7%"><field name="TEXT">Your_wifi_SSID_name</field></block></value><next><block type="variables_set" id="^LZ,qC9RetTI8./[N;tT"><field name="VAR" id="$5gL69CYgbO,}5wH5$Nw">PASSWORD_1</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="text" id="=o%4gRcX*Bhl^1-Z)f]@"><field name="TEXT">your_wifi_password</field></block></value><next><block type="variables_set" id="?c-%FdY9m}k$-`CI#M*0"><field name="VAR" id="Io?1mB-?z=A%GA;@e2D`">SSID_2</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="text" id="B!!|M)Kmvy{PEIWX,Zr/"><field name="TEXT">ESP8266</field></block></value><next><block type="variables_set" id="Rk(ID1a*P9@#tM~Gdg;E"><field name="VAR" id="A1u`W_fj!F7F7N6pgGH.">PASSWORD_2</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="text" id="S/q$,RGdeeZPKqQOgStB"><field name="TEXT">microbit</field></block></value><next><block type="typescript_statement" id="nK9oJT%8#=8pz=zTC_x{" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="pins.digitalWritePin(LED_pin, 0)" numlines="1"></mutation><next><block type="typescript_statement" id="Z$hM$kiUto#}{}`epS%$" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="serial.redirect(Tx_pin, Rx_pin, 115200)" numlines="1"></mutation><next><block type="typescript_statement" id="UV4ETJ:rkq.0r{b%Mdb?" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="sendAT(&quot;AT+RESTORE&quot;, 1000)" numlines="1"></mutation><comment>設定ESP-01</comment><next><block type="typescript_statement" id="iZB.fPHibWu1fpCCiNo!" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="sendAT(&quot;AT+RST&quot;, 1000)" numlines="1"></mutation><next><block type="typescript_statement" id="~Y).3_NG9ccOl-o.Q#!m" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="sendAT(&quot;AT+CWMODE=&quot; + WIFI_MODE)" numlines="1"></mutation><next><block type="controls_if" id="ju=#l)~W6GWd7tY=MDUH"><mutation elseif="1"/><value name="IF0"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="_X_PaF)A@/+a`dxxXoR;"><field name="OP">EQ</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="98^K`h[,$ntj@z9KX7_o"><field name="VAR" id="++7BR~T2W[|hza3Dw1_z">WIFI_MODE</field></block></value><value name="B"><shadow type="math_number" id="%TQlFK[EUEZCpgIg;[it"><field name="NUM">1</field></shadow></value></block></value><statement name="DO0"><block type="typescript_statement" id="oW(0*[/h@nMu[tiDA9N8" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="sendAT(&quot;AT+CWJAP=\&quot;&quot; + SSID_1 + &quot;\&quot;,\&quot;&quot; + PASSWORD_1 + &quot;\&quot;&quot;)" numlines="1"></mutation><next><block type="typescript_statement" id="9s27BK#*C(h%(vKRH!NQ" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="let result: boolean = wait_for_response(&quot;OK&quot;)" numlines="1" declaredvars="result"></mutation><next><block type="controls_if" id="J%;+(^^G#25PCEehZG|S"><value name="IF0"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_negate" id="G)[#xQEG=uOwvf*D?0!S"><value name="BOOL"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="variables_get" id="t#A|?ei;={BmdPH)%]oF"><field name="VAR" id="{;{s^eq?FqUKd(X,X4Nh">result</field></block></value></block></value><statement name="DO0"><block type="control_reset" id="{y!lLufb6T,g#*|08R/!"/></statement></block></next></block></next></block></statement><value name="IF1"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="Y@eh:x27E8-YM!0@N[l%"><field name="OP">EQ</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="?~+Hq)r0?,XAM7l7QRUc"><field name="VAR" id="++7BR~T2W[|hza3Dw1_z">WIFI_MODE</field></block></value><value name="B"><shadow type="math_number" id="zRZxEy2egK6YnBbXh!|4"><field name="NUM">2</field></shadow></value></block></value><statement name="DO1"><block type="typescript_statement" id="MaFTiX3?wda+.g%gH8fv" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="sendAT(&quot;AT+CWSAP=\&quot;&quot; + SSID_2 + &quot;\&quot;,\&quot;&quot; + PASSWORD_2 + &quot;\&quot;,1,4&quot;, 1000)" numlines="1"></mutation><comment>開放1個連線頻道, 驗證模式=4 (WPA_WPA2_PSK)</comment></block></statement><next><block type="typescript_statement" id="Iw?oc,$`rKAce}AL.-?z" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="sendAT(&quot;AT+CIPMUX=1&quot;)" numlines="1"></mutation><comment>設定伺服器</comment><next><block type="typescript_statement" id="A@d;LfWqwL.Jx3GB%WrX" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="sendAT(&quot;AT+CIPSERVER=1,80&quot;)" numlines="1"></mutation><next><block type="typescript_statement" id="SvrJB2Fa+uNLQ/B?2z_i" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="sendAT(&quot;AT+CIFSR&quot;)" numlines="1"></mutation><comment>顯示IP (在AP模式預設為192.168.4.1)</comment><next><block type="neopixel_set_strip_color" id="T7aqnFb+dciVnSR5%=,I"><value name="strip"><block type="variables_get" id="_s=,*!jv13}wdZffj+PE"><field name="VAR" id="}8~?dPAgLJYQa`am+6J|">strip</field></block></value><value name="rgb"><shadow type="neopixel_colors" id="DG*5Jfd]kR+di*sT(.ws"><field name="color">NeoPixelColors.Black</field></shadow></value><next><block type="basic_show_icon" id="^iPy7rF1uzg9)A=k_9dc"><field name="i">IconNames.Yes</field><comment>顯示打勾圖案, 伺服器完成開啟</comment><next><block type="device_while" id="PHe3Q_/%8kCPgRp0hCEE"><comment>處理HTTP請求</comment><value name="COND"><shadow type="logic_boolean" id="O77Fm:$tv9gnU:-k,OLi"><field name="BOOL">TRUE</field></shadow></value><statement name="DO"><block type="variables_set" id="rYgaoUN:{][)hr/n=^V2"><field name="VAR" id="V/][yu!D*sB/4,XfRWjS">serial_str</field><comment>儲存最長200字的序列資料, 以免loss掉</comment><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="text_join" id="2qf+ZjX;~-q.c:aG;~PB"><mutation items="3"/><value name="ADD0"><shadow type="text" id="o+5Xo[`OCK`jA.uxeB=Y"><field name="TEXT"/></shadow></value><value name="ADD1"><shadow type="text"><field name="TEXT"/></shadow><block type="variables_get" id="c3UHIeDt^@L,cZ7HD5.6"><field name="VAR" id="V/][yu!D*sB/4,XfRWjS">serial_str</field></block></value><value name="ADD2"><shadow type="text"><field name="TEXT"/></shadow><block type="serial_read_buffer" id="l=ZK?o4Q^/W=Li7VchSB"/></value></block></value><next><block type="controls_if" id="!Q~2o6b,$1fv2J|~b-D*"><value name="IF0"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="mZJ#HPM|@t(eC=jts7Fi"><field name="OP">GT</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="text_length" id="PI_KZ3ye|x@AuJogy@]i"><value name="VALUE"><block type="variables_get" id="i+LA+]CR]_Vq8AVB124_"><field name="VAR" id="V/][yu!D*sB/4,XfRWjS">serial_str</field></block></value></block></value><value name="B"><shadow type="math_number" id="p-JOd9YA8[66q;%6zL6H"><field name="NUM">200</field></shadow></value></block></value><statement name="DO0"><block type="variables_set" id="+LtZl+ER:O_81$=!PgsJ"><field name="VAR" id="V/][yu!D*sB/4,XfRWjS">serial_str</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="string_substr" id="j#s%I^+y}mbq{OTp5k[*"><value name="this"><shadow type="text"><field name="TEXT"/></shadow><block type="variables_get" id="$:2}R~6$C7=oz,7cdo01"><field name="VAR" id="V/][yu!D*sB/4,XfRWjS">serial_str</field></block></value><value name="start"><block type="math_arithmetic" id="E9{EeY]Dfapk$!j}$Kf}"><field name="OP">MINUS</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="text_length" id="_PW?HHSLybBaOF:(Q62o"><value name="VALUE"><block type="variables_get" id="Xf:/Rn6uqtQB?nr%`YUc"><field name="VAR" id="V/][yu!D*sB/4,XfRWjS">serial_str</field></block></value></block></value><value name="B"><shadow type="math_number" id="a}l,zw`-uSl_kT(h16{Y"><field name="NUM">200</field></shadow></value></block></value><value name="length"><shadow type="math_number" id="O[b%#u6X]m.+:AAZCNeO"><field name="NUM">0</field></shadow></value></block></value></block></statement><next><block type="controls_if" id="G(7_e/T?QkbAt6(oDWM]"><value name="IF0"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_operation" id="sq();l}ohb.=Y,CRsQo`"><field name="OP">AND</field><value name="A"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="typescript_expression" id="x*2V1|-:[_ZS61xABq)?" editable="false"><field name="EXPRESSION">serial_str.includes("+IPD")</field></block></value><value name="B"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="typescript_expression" id="6cd[Bo?lnVH;`@`gu26S" editable="false"><field name="EXPRESSION">serial_str.includes("HTTP")</field></block></value></block></value><statement name="DO0"><block type="variables_set" id="^VS}M|2g(T^wlT`[zccw"><field name="VAR" id="^fLp6BtXTeCO$uIr@qd@">client_ID</field><comment>有連線請求</comment><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="string_substr" id="wXz4/FU{NG0-UG`},/x@"><value name="this"><shadow type="text"><field name="TEXT"/></shadow><block type="variables_get" id="g9ED9(3Cw6Xgw;EFLn?$"><field name="VAR" id="V/][yu!D*sB/4,XfRWjS">serial_str</field></block></value><value name="start"><block type="math_arithmetic" id="LjMklQxRbK5fKlrLaZSa"><field name="OP">ADD</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="typescript_expression" id="L?WAxq51DBr8GVjY?1x5" editable="false"><field name="EXPRESSION">serial_str.indexOf("IPD")</field></block></value><value name="B"><shadow type="math_number" id="[|@^cf|vZyKDXYM!h%I-"><field name="NUM">4</field></shadow></value></block></value><value name="length"><shadow type="math_number" id="nR~/2PXK9)nK[%5yOB/T"><field name="NUM">1</field></shadow></value></block></value><next><block type="typescript_statement" id="02;#4,Kz5lE}}kqKzxip" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="let GET_pos: number = serial_str.indexOf(&quot;GET&quot;)" numlines="1" declaredvars="GET_pos"></mutation><next><block type="typescript_statement" id="=#1-)O80;[?kNcH$*Img" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="let HTTP_pos: number = serial_str.indexOf(&quot;HTTP&quot;)" numlines="1" declaredvars="HTTP_pos"></mutation><next><block type="variables_set" id="=!M{KlS/|TB]IP{~kROz"><field name="VAR" id="aKlUvx~CY#P1WpSda]zj">GET_command</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="string_substr" id=",bt}m7L/X@FfMTaAh4ck"><value name="this"><shadow type="text"><field name="TEXT"/></shadow><block type="variables_get" id="[3BVWXT{St5l9)ylH5%P"><field name="VAR" id="V/][yu!D*sB/4,XfRWjS">serial_str</field></block></value><value name="start"><block type="math_arithmetic" id="0k~GEdn9MR)e$-6pb2iP"><field name="OP">ADD</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="h{|u_G7c`5+JUSB{P)yA"><field name="VAR" id="jMDFA?[3O]fgxriKhf[5">GET_pos</field></block></value><value name="B"><shadow type="math_number" id="I@|3_jT3M!a^[]Y%l:Jr"><field name="NUM">5</field></shadow></value></block></value><value name="length"><block type="math_arithmetic" id="dyvII^~_z94IFRc:l{QP"><field name="OP">MINUS</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="9+6]4@!t*P/mhu`WM[y;"><field name="OP">MINUS</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="-qJsW{75[_iR4=()J(*F"><field name="VAR" id="_awNfogzFHn(`eA]M8Q%">HTTP_pos</field></block></value><value name="B"><shadow type="math_number" id="#F#jjdQK+?Os{geRG6X1"><field name="NUM">1</field></shadow></value></block></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="9O`:Fzr8}=JK-PCi+8K!"><field name="OP">ADD</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="tzFdVtA2q)3U}SSG.T_*"><field name="VAR" id="jMDFA?[3O]fgxriKhf[5">GET_pos</field></block></value><value name="B"><shadow type="math_number" id="1g?$qEjN~Lu-#xWf?Ir`"><field name="NUM">5</field></shadow></value></block></value></block></value></block></value><next><block type="typescript_statement" id="JM:z0.^jbnqt[0:)181j" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="switch (GET_command) {" line1="            case &quot;&quot;: // request 192.168.x.x/" line2="                GET_success = true" line3="                break" line4="            case &quot;LED&quot;: // request 192.168.x.x/LED" line5="                GET_success = true" line6="                LED_status = 1 - LED_status" line7="                pins.digitalWritePin(LED_pin, LED_status)" line8="" line9="                if (LED_status == 1) {" line10="                    strip.showColor(neopixel.colors(NeoPixelColors.White))" line11="                } else {" line12="                    strip.showColor(neopixel.colors(NeoPixelColors.Black))" line13="                }" line14="                strip.show()" line15="" line16="                break" line17="            case &quot;LEDON&quot;: // request 192.168.x.x/LED" line18="                GET_success = true" line19="                LED_status = 1" line20="                pins.digitalWritePin(LED_pin, LED_status)" line21="" line22="                if (LED_status == 1) {" line23="                    strip.showColor(neopixel.colors(NeoPixelColors.White))" line24="                } else {" line25="                    strip.showColor(neopixel.colors(NeoPixelColors.Black))" line26="                }" line27="                strip.show()" line28="" line29="                break" line30="            case &quot;LEDOFF&quot;: // request 192.168.x.x/LED" line31="                GET_success = true" line32="                LED_status = 0" line33="                pins.digitalWritePin(LED_pin, LED_status)" line34="" line35="                if (LED_status == 1) {" line36="                    strip.showColor(neopixel.colors(NeoPixelColors.White))" line37="                } else {" line38="                    strip.showColor(neopixel.colors(NeoPixelColors.Black))" line39="                }" line40="                strip.show()" line41="" line42="                break" line43="        }" numlines="44"></mutation><comment>判斷GET指令</comment><next><block type="typescript_statement" id="Gs_GXYmOLM(!6(W]k:|2" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="let HTML_str: string = getHTML(GET_success)" numlines="1" declaredvars="HTML_str"></mutation><comment>產生HTML並傳給使用者</comment><next><block type="typescript_statement" id="Q.cXwH3lXtPztt3Iz#ly" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="sendAT(&quot;AT+CIPSEND=&quot; + client_ID + &quot;,&quot; + (HTML_str.length + 2))" numlines="1"></mutation><next><block type="typescript_statement" id="%x#.bFlf`v:+;k1~WSin" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="sendAT(HTML_str, 1000)" numlines="1"></mutation><next><block type="typescript_statement" id="|P^UqnQ[io6D}UXj2[i]" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="sendAT(&quot;AT+CIPCLOSE=&quot; + client_ID)" numlines="1"></mutation><comment>關閉連線</comment><next><block type="variables_set" id="CQu^6;f;9$|h#nm:57ip"><field name="VAR" id="V/][yu!D*sB/4,XfRWjS">serial_str</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="text" id="m]_a}XZ$0!mYLX.3@(oU"><field name="TEXT"/></block></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block></next></block></next></block></statement><next><block type="typescript_statement" id="-E9+-qU$`NbYR[MZYQfI" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="function sendAT(command: string, waitTime: number = 100) {" line1="    serial.writeString(command + &quot;\u000D\u000A&quot;)" line2="    basic.pause(waitTime)" line3="}" numlines="4"></mutation><comment>寫入AT指令並加上CR+LF</comment><next><block type="typescript_statement" id="37ORHMMzV2n9vSWQ,Sc8" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="function getHTML(normal: boolean): string {" line1="    let LED_statusString: string = &quot;&quot;" line2="    let LED_buttonString: string = &quot;&quot;" line3="    let web_title: string = &quot;Tech Box Wifi on micro:bit&quot;" line4="    let html: string = &quot;&quot;" line5="    html += &quot;HTTP/1.1 200 OK\r\n&quot;" line6="    html += &quot;Content-Type: text/html\r\n&quot;" line7="    html += &quot;Connection: close\r\n\r\n&quot;" line8="    html += &quot;&lt;!DOCTYPE html&gt;&quot;" line9="    html += &quot;&lt;html&gt;&quot;" line10="    html += &quot;&lt;head&gt;&quot;" line11="    html += &quot;&lt;link rel=\&quot;icon\&quot; href=\&quot;data:,\&quot;&gt;&quot;" line12="    html += &quot;&lt;title&gt;&quot; + web_title + &quot;&lt;/title&gt;&quot;" line13="    html += &quot;&lt;meta name=\&quot;viewport\&quot; content=\&quot;width=device-width, initial-scale=1\&quot;&gt;&quot; // mobile view" line14="    html += &quot;&lt;/head&gt;&quot;" line15="    html += &quot;&lt;body&gt;&quot;" line16="    html += &quot;&lt;div style=\&quot;text-align:center\&quot;&gt;&quot;" line17="    html += &quot;&lt;h1&gt;&quot; + web_title + &quot;&lt;/h1&gt;&quot;" line18="    html += &quot;&lt;br&gt;&quot;" line19="    let NOT_LED_statusString = &quot;&quot;" line20="    if (normal) {" line21="        if (LED_status) {" line22="            LED_statusString = &quot;ON&quot;" line23="            LED_buttonString = &quot;TURN IT OFF&quot;" line24="            NOT_LED_statusString = &quot;OFF&quot;" line25="        } else {" line26="            LED_statusString = &quot;OFF&quot;" line27="            LED_buttonString = &quot;TURN IT ON&quot;" line28="            NOT_LED_statusString = &quot;ON&quot;" line29="        }" line30="        html += &quot;&lt;h3&gt;LED STATUS: &quot; + LED_statusString + &quot;&lt;/h3&gt;&quot;" line31="        html += &quot;&lt;br&gt;&quot;" line32="        html += &quot;&lt;input type=\&quot;button\&quot; onClick=\&quot;window.location.href=\'LED&quot; + NOT_LED_statusString + &quot;\'\&quot; value=\&quot;&quot; + LED_buttonString + &quot;\&quot;&gt;&quot;" line33="        html += &quot;&lt;br&gt;&quot;" line34="    } else {" line35="        html += &quot;&lt;h3&gt;ERROR: REQUEST NOT FOUND&lt;/h3&gt;&quot;" line36="    }" line37="    html += &quot;&lt;br&gt;&quot;" line38="    html += &quot;&lt;input type=\&quot;button\&quot; onClick=\&quot;window.location.href=\'/'\&quot; value=\&quot;Home\&quot;&gt;&quot;" line39="    html += &quot;&lt;/div&gt;&quot;" line40="    html += &quot;&lt;/body&gt;&quot;" line41="    html += &quot;&lt;/html&gt;&quot;" line42="    return html" line43="}" numlines="44"></mutation><comment>產生客戶端HTML</comment><next><block type="typescript_statement" id=".`hlRU|!koEWQ1x[!eDT" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="function wait_for_response(str: string): boolean {" line1="    let result2: boolean = false" line2="    let time: number = input.runningTime()" line3="    while (true) {" line4="        serial_str += serial.readString()" line5="        if (serial_str.length &gt; 200) {" line6="            serial_str = serial_str.substr(serial_str.length - 200)" line7="        }" line8="        if (serial_str.includes(str)) {" line9="            result2 = true" line10="            break" line11="        }" line12="        if (input.runningTime() - time &gt; 300000) break" line13="    }" line14="    return result2" line15="}" numlines="16"></mutation><comment>等待wifi連線用</comment></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block></xml>